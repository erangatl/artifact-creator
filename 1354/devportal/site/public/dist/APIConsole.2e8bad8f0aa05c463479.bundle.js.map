{"version":3,"sources":["webpack:///./source/src/app/components/Apis/Details/ApiConsole/SwaggerUI.jsx","webpack:///./source/src/app/components/Apis/Details/ApiConsole/ApiConsole.jsx"],"names":["disableAuthorizeAndInfoPlugin","wrapComponents","info","authorizeBtn","SwaggerUI","props","spec","accessTokenProvider","authorizationHeader","api","securitySchemeType","componentProps","validatorUrl","defaultModelsExpandDepth","docExpansion","requestInterceptor","req","url","context","patternToCheck","headers","endsWith","substring","length","includes","splitTokens","split","defaultModelExpandDepth","plugins","render","setRender","useState","layoutRender","setlayoutRender","useEffect","len","document","querySelectorAll","i","remove","querySelector","setAttribute","getElementById","parentNode","propTypes","PropTypes","func","isRequired","string","shape","ApiConsole","React","Component","constructor","super","this","state","username","password","scopes","selectedKeyType","keys","productionApiKey","sandboxApiKey","selectedKeyManager","bind","updateSwagger","setSecurityScheme","setSelectedEnvironment","setProductionAccessToken","setSandboxAccessToken","setUsername","setPassword","setSelectedKeyType","setSectedKeyManager","setSelectedKeyManager","setKeys","updateAccessToken","setProductionApiKey","setSandboxApiKey","componentDidMount","apiID","id","user","AuthManager","getUser","apiData","environments","containerMngEnvironments","labels","selectedEnvironment","swagger","apiClient","Api","getAPIById","then","apiResponse","obj","endpointURLs","map","endpoint","environmentName","ingressURLs","label","name","scopeList","scope","key","setState","getSwaggerByAPIIdAndEnvironment","some","env","clusterDetails","clusterName","find","getSwaggerByAPIIdAndClusterName","getSwaggerByAPIIdAndLabel","getSwaggerByAPIId","swaggerResponse","defaultSecurityScheme","securityScheme","productionAccessToken","sandboxAccessToken","getSubscriptions","catch","error","status","notFound","isUpdateToken","selectedApplication","accessToken","get","keyType","token","Application","application","getKeys","appKeys","btoa","environment","promiseSwagger","cluster","classes","downloadSwagger","JSON","stringify","downloadLink","encodeURIComponent","Progress","isApiKeyEnabled","isPrototypedAPI","lifeCycleStatus","toLowerCase","Typography","variant","className","titleSub","component","defaultMessage","Paper","paper","Grid","container","grid","item","md","userNotificationPaper","Icon","TryOutController","xs","href","download","buttonText","buttonIcon","swaggerUIPaper","contextType","ApiContext","withStyles","theme","marginRight","margin","spacing","padding","marginTop","marginBottom","paddingRight","justifyContent","marginLeft","paddingTop","paddingBottom","color","palette","getContrastText","background","default","backgroundColor","custom","apiDetailPages","swaggerUIBackground","display"],"mappings":"8TAKA,MAAMA,EAAgC,WAClC,MAAO,CACHC,eAAgB,CACZC,KAAM,IAAM,IAAM,KAClBC,aAAc,IAAM,IAAM,QAShCC,EAAaC,IACf,MAAM,KACFC,EADE,oBACIC,EADJ,oBACyBC,EADzB,IAC8CC,EAD9C,mBACmDC,GACrDL,EAEEM,EAAiB,CACnBL,OACAM,aAAc,KACdC,0BAA2B,EAC3BC,aAAc,OACdC,mBAAqBC,IACjB,MAAM,IAAEC,GAAQD,GACV,QAAEE,GAAYT,EACdU,EAAkB,GAAED,MAU1B,GARIF,EAAII,QAAQZ,GADY,WAAxBA,EACmCD,IACL,UAAvBG,EAC4B,SAAWH,IAChB,SAAvBG,EAC4BH,IAEA,UAAYA,IAE/CU,EAAII,SAASF,GACbH,EAAIC,IAAMA,EAAIK,UAAU,EAAGL,EAAIM,OAAS,QACrC,GAAIN,EAAIO,SAASL,EAAiB,KAAM,CAC3C,MAAMM,EAAcR,EAAIS,MAAM,OAC9BV,EAAIC,IAAMQ,EAAYF,OAAS,EAAIE,EAAY,GAAK,IAAMA,EAAY,GAAKA,EAAY,GAE3F,OAAOT,GAEXW,yBAA0B,EAC1BC,QAAS,CAAC5B,KAGP6B,EAAQC,GAAaC,sBACrBC,EAAcC,GAAmBF,qBAkBxC,OAhBAG,oBAAU,KACN,IAAKF,EAAc,OACnB,MAAMG,EAAMC,SAASC,iBAAiB,gCACtC,IAAIC,EAAI,EACR,KAAOA,EAAIH,EAAIZ,OAAQe,IACnBH,EAAIG,GAAGC,SAEXH,SAASI,cAAc,mBAAmBC,aAAa,KAAM,WAC7DL,SAASM,eAAe,YAAYC,WAAWA,WAAWJ,SAC1DN,GAAgB,IACjB,CAACD,IAEJE,oBAAU,KACND,GAAgB,IACjB,CAACJ,IAGA,oCACI,kBAAC,IAAiBlB,GACjBmB,IAKb1B,EAAUwC,UAAY,CAClBrC,oBAAqBsC,IAAUC,KAAKC,WACpCvC,oBAAqBqC,IAAUG,OAAOD,WACtCtC,IAAKoC,IAAUI,MAAM,CACjB/B,QAAS2B,IAAUG,OAAOD,aAC3BA,WACHzC,KAAMuC,IAAUG,OAAOD,YAEZ3C,Q,yWCXf,MAAM8C,UAAmBC,IAAMC,UAM3BC,YAAYhD,GACRiD,MAAMjD,GACNkD,KAAKC,MAAQ,CACT9C,mBAAoB,QACpB+C,SAAU,GACVC,SAAU,GACVC,OAAQ,GACRC,gBAAiB,aACjBC,KAAM,GACNC,iBAAkB,GAClBC,cAAe,GACfC,mBAAoB,wBAExBT,KAAKhD,oBAAsBgD,KAAKhD,oBAAoB0D,KAAKV,MACzDA,KAAKW,cAAgBX,KAAKW,cAAcD,KAAKV,MAC7CA,KAAKY,kBAAoBZ,KAAKY,kBAAkBF,KAAKV,MACrDA,KAAKa,uBAAyBb,KAAKa,uBAAuBH,KAAKV,MAC/DA,KAAKc,yBAA2Bd,KAAKc,yBAAyBJ,KAAKV,MACnEA,KAAKe,sBAAwBf,KAAKe,sBAAsBL,KAAKV,MAC7DA,KAAKgB,YAAchB,KAAKgB,YAAYN,KAAKV,MACzCA,KAAKiB,YAAcjB,KAAKiB,YAAYP,KAAKV,MACzCA,KAAKkB,mBAAqBlB,KAAKkB,mBAAmBR,KAAKV,MACvDA,KAAKmB,oBAAsBnB,KAAKoB,sBAAsBV,KAAKV,MAC3DA,KAAKqB,QAAUrB,KAAKqB,QAAQX,KAAKV,MACjCA,KAAKsB,kBAAoBtB,KAAKsB,kBAAkBZ,KAAKV,MACrDA,KAAKuB,oBAAsBvB,KAAKuB,oBAAoBb,KAAKV,MACzDA,KAAKwB,iBAAmBxB,KAAKwB,iBAAiBd,KAAKV,MAMvDyB,oBACI,MAAM,IAAEvE,GAAQ8C,KAAKrC,QACf+D,EAAQxE,EAAIyE,GACZC,EAAOC,IAAYC,UACzB,IAAIC,EACAC,EACAC,EACAC,EACAC,EACAC,EAIJpC,KAAKqC,UAAY,IAAIC,IACFtC,KAAKqC,UAAUE,WAAWb,GAGxCc,KAAMC,IASH,IARAV,EAAUU,EAAYC,KACVC,eACRX,EAAeD,EAAQY,aAAaC,IAAKC,GAAsBA,EAASC,kBAE5Eb,EAA2BF,EAAQgB,YAC/BhB,EAAQG,SACRA,EAASH,EAAQG,OAAOU,IAAKI,GAAmBA,EAAMC,OAEtDlB,EAAQ3B,OAAQ,CAChB,MAAM8C,EAAYnB,EAAQ3B,OAAOwC,IAAKO,GAAmBA,EAAMC,KAC/DpD,KAAKqD,SAAS,CAAEjD,OAAQ8C,IAE5B,GAAIlB,GAAgBA,EAAahE,OAAS,EAEtC,OADCmE,GAAuBH,EACjBhC,KAAKqC,UAAUiB,gCAAgC5B,EAAOS,GAC1D,GAAIF,GACJA,EAAyBsB,KAAMC,GAAQA,EAAIC,eAAezF,OAAS,GAAI,CAC1E,MAAQyF,iBAAiB,YAAEC,KAAmBzB,EACzC0B,KAAMH,GAAQA,EAAIC,eAAezF,OAAS,GAE/C,OADAmE,EAAsBuB,EACf1D,KAAKqC,UAAUuB,gCAAgClC,EAAOgC,GAC1D,OAAIxB,GAAUA,EAAOlE,OAAS,IAChCmE,GAAuBD,EACjBlC,KAAKqC,UAAUwB,0BAA0BnC,EAAOS,IAEhDnC,KAAKqC,UAAUyB,kBAAkBpC,KAG/Cc,KAAMuB,IACH3B,EAAU2B,EAAgBrB,IAE1B,IAAIsB,EAAwB,QAgB5B,OAfKjC,EAAQkC,eAAehG,SAAS,YACjC+F,EAAwBjC,EAAQkC,eAAehG,SAAS,WAAa,UAAY,SAGrF+B,KAAKqD,SAAS,CACVnG,IAAK6E,EACLK,UACAJ,eACAC,2BACAC,SACAgC,2BAlDRA,EAmDQC,wBAlDRA,EAmDQhC,sBACAhF,mBAAoB6G,IAEZ,MAARpC,EACO5B,KAAKqC,UAAU+B,iBAAiB1C,GAEhC,OAGd2C,MAAOC,IAIJ,MAAM,OAAEC,GAAWD,EACJ,MAAXC,GACAvE,KAAKqD,SAAS,CAAEmB,UAAU,MAS1C5D,kBAAkBqD,GACdjE,KAAKqD,SAAS,CAAElG,mBAAoB8G,IAOxCpD,uBAAuBsB,GACnBnC,KAAKqD,SAAS,CAAElB,wBAOpBrB,yBAAyBoD,GACrBlE,KAAKqD,SAAS,CAAEa,0BAOpBnD,sBAAsBoD,GAClBnE,KAAKqD,SAAS,CAAEc,uBAOpB5C,oBAAoBhB,GAChBP,KAAKqD,SAAS,CAAE9C,qBAOpBiB,iBAAiBhB,GACbR,KAAKqD,SAAS,CAAE7C,kBAOpBQ,YAAYd,GACRF,KAAKqD,SAAS,CAAEnD,aAOpBe,YAAYd,GACRH,KAAKqD,SAAS,CAAElD,aAOpBe,mBAAmBb,EAAiBoE,EAAeC,GAC3CD,EACAzE,KAAKqD,SAAS,CAAEhD,mBAAmBL,KAAKsB,kBAAkBoD,IAE1D1E,KAAKqD,SAAS,CAAEhD,oBAQxBe,sBAAsBX,EAAoBgE,EAAeC,GACjDD,EACAzE,KAAKqD,SAAS,CAAE5C,sBAAsBT,KAAKsB,kBAAkBoD,IAE7D1E,KAAKqD,SAAS,CAAE5C,uBAIxBY,QAAQf,GACJN,KAAKqD,SAAS,CAAE/C,SAOpBgB,kBAAkBoD,GACd,MAAM,gBACFrE,EADE,mBACeI,EADf,KACmCH,GACrCN,KAAKC,MACT,IAAI0E,EACArE,EAAKsE,IAAInE,IAAuBH,EAAKsE,IAAInE,GAAoBoE,UAAYxE,KACtEsE,eAAgBrE,EAAKsE,IAAInE,GAAoBqE,OACxB,eAApBzE,EACAL,KAAKc,yBAAyB6D,GAE9B3E,KAAKe,sBAAsB4D,IAG/BI,IAAYH,IAAIF,GACXlC,KAAMwC,GACIA,EAAYC,QAAQ5E,IAE9BmC,KAAM0C,IACCA,EAAQN,IAAInE,IACbyE,EAAQN,IAAInE,GAAoBoE,UAAYxE,KACxCsE,eAAgBO,EAAQN,IAAInE,GAAoBqE,OAEP,eAA5CI,EAAQN,IAAInE,GAAoBoE,QAChC7E,KAAKc,yBAAyB6D,GAE9B3E,KAAKe,sBAAsB4D,GAE/B3E,KAAKqB,QAAQ6D,KAW7BlI,sBACI,MAAM,mBACFG,EADE,SACkB+C,EADlB,SAC4BC,EAD5B,sBACsC+D,EADtC,mBAEFC,EAFE,gBAEkB9D,EAFlB,iBAEmCE,EAFnC,cAEqDC,GACvDR,KAAKC,MACT,GAA2B,UAAvB9C,EAAgC,CAEhC,OAAOgI,KADajF,EAAW,IAAMC,GAGzC,MAA2B,YAAvBhD,EACwB,eAApBkD,EACOE,EAEAC,EAEgB,eAApBH,EACA6D,EAEAC,EAQfxD,cAAcyE,GACV,MAAM,IACFlI,EADE,aACG8E,EADH,yBACiBC,GACnBjC,KAAKC,MACT,IAAIoF,GAIIA,EAFJD,EACIpD,EAAa/D,SAASmH,GACLpF,KAAKqC,UAAUiB,gCAAgCpG,EAAIyE,GAAIyD,GACjEnD,EAAyBsB,KAAMC,GAAQA,EAAIC,eAAezF,OAAS,GACvEwF,EAAIC,eAAeF,KAAM+B,GAAYA,EAAQ5B,cAAgB0B,IAC/CpF,KAAKqC,UAAUuB,gCAAgC1G,EAAIyE,GAAIyD,GAEvDpF,KAAKqC,UAAUwB,0BAA0B3G,EAAIyE,GAAIyD,GAGrDpF,KAAKqC,UAAUyB,kBAAkB5G,EAAIyE,KAE3Ca,KAAMuB,IACjB/D,KAAKqD,SAAS,CAAEjB,QAAS2B,EAAgBrB,QAQjDpE,SACI,MAAM,QAAEiH,GAAYvF,KAAKlD,OACnB,IACFI,EADE,SACGsH,EADH,QACapC,EADb,mBACsBjF,EADtB,oBAC0CgF,EAD1C,OAC+DD,EAD/D,aACuEF,EADvE,OACqF5B,EADrF,SAEFF,EAFE,SAEQC,EAFR,sBAEkB+D,EAFlB,mBAEyCC,EAFzC,gBAE6D9D,EAF7D,cAGFG,EAHE,iBAGaD,EAHb,mBAG+BE,EAH/B,yBAGmDwB,GACrDjC,KAAKC,MACH2B,EAAOC,IAAYC,UACnB0D,EAAkBC,KAAKC,U,+VAAL,IAAoBtD,IACtCuD,EAAe,iCAAmCC,mBAAmBJ,GAG3E,GAAW,MAAPtI,GAA0B,MAAXkF,EACf,OAAO,kBAACyD,EAAA,EAAD,MAEX,GAAIrB,EACA,MAAO,kBAEX,IAAIsB,GAAkB,EAClB7I,EAAsBC,EAAID,oBAAsBC,EAAID,oBAAsB,gBAC1EC,GAAOA,EAAI+G,iBACX6B,EAAkB5I,EAAI+G,eAAehG,SAAS,aACA,YAAvBd,IACnBF,EAAsB,UAG9B,MAAM8I,EAAkB7I,EAAI8I,iBAAyD,eAAtC9I,EAAI8I,gBAAgBC,cACnE,OACI,oCACI,kBAACC,EAAA,EAAD,CAAYC,QAAQ,KAAKC,UAAWb,EAAQc,SAAUC,UAAU,MAC5D,kBAAC,IAAD,CAAkB3E,GAAG,2CAA2C4E,eAAe,aAEnF,kBAACC,EAAA,EAAD,CAAOJ,UAAWb,EAAQkB,OACtB,kBAACC,EAAA,EAAD,CAAMC,WAAS,EAACP,UAAWb,EAAQqB,OAC7Bb,IAAoBnE,GAClB,kBAAC8E,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACN,EAAA,EAAD,CAAOJ,UAAWb,EAAQwB,uBACtB,kBAACb,EAAA,EAAD,CAAYC,QAAQ,KAAKG,UAAU,MAC/B,kBAACU,EAAA,EAAD,gBACC,IACD,kBAAC,IAAD,CAAkBrF,GAAG,SAAS4E,eAAe,YAEjD,kBAACL,EAAA,EAAD,CAAYI,UAAU,KAClB,kBAAC,IAAD,CACI3E,GAAG,mCACH4E,eAAgB,mLAUxC,kBAACU,EAAA,EAAD,CACIrG,kBAAmBZ,KAAKY,kBACxBzD,mBAAoBA,EACpB0D,uBAAwBb,KAAKa,uBAC7BsB,oBAAqBA,EACrB+B,sBAAuBA,EACvBpD,yBAA0Bd,KAAKc,yBAC/BqD,mBAAoBA,EACpBpD,sBAAuBf,KAAKe,sBAC5BqB,QAASA,EACTF,OAAQA,EACRD,yBAA0BA,EAC1BD,aAAcA,EACd5B,OAAQA,EACRY,YAAahB,KAAKgB,YAClBC,YAAajB,KAAKiB,YAClBf,SAAUA,EACVC,SAAUA,EACVe,mBAAoBlB,KAAKkB,mBACzBb,gBAAiBA,EACjBe,sBAAuBpB,KAAKoB,sBAC5BX,mBAAoBA,EACpBE,cAAeX,KAAKW,cACpBU,QAASrB,KAAKqB,QACdE,oBAAqBvB,KAAKuB,oBAC1BC,iBAAkBxB,KAAKwB,iBACvBjB,iBAAkBA,EAClBC,cAAeA,EACftD,IAAK8C,KAAKC,MAAM/C,MAGpB,kBAACwJ,EAAA,EAAD,CAAMC,WAAS,GACX,kBAACD,EAAA,EAAD,CAAMQ,GAAI,GAAIL,MAAI,IAClB,kBAACH,EAAA,EAAD,CAAMQ,GAAI,EAAGL,MAAI,GACb,uBAAGM,KAAMxB,EAAcyB,SA/E1B,gBAgFO,kBAAClB,EAAA,EAAD,CAAYI,UAAU,OAAOF,UAAWb,EAAQ8B,YAC5C,kBAAC,IAAD,CAAsBjB,UAAWb,EAAQ+B,aACzC,kBAAC,IAAD,CACI3F,GAAG,sDACH4E,eAAe,mCAOvC,kBAACC,EAAA,EAAD,CAAOJ,UAAWb,EAAQgC,gBACtB,kBAAC,EAAD,CACIrK,IAAK8C,KAAKC,MAAM/C,IAChBF,oBAAqBgD,KAAKhD,oBAC1BD,KAAMqF,EACNnF,oBAAqBA,EACrBE,mBAAoBA,OAQ5CwC,EAAWN,UAAY,CACnBkG,QAASjG,IAAUI,MAAM,CACrB+G,MAAOnH,IAAUG,OAAOD,WACxB6G,SAAU/G,IAAUG,OAAOD,WAC3BoH,KAAMtH,IAAUG,OAAOD,WACvBuH,sBAAuBzH,IAAUG,OAAOD,WACxC8H,WAAYhI,IAAUG,OAAOD,aAC9BA,YAGPG,EAAW6H,YAAcC,IAEVC,sBAxdCC,IAAD,CACXL,WAAY,CACRM,YAAa,IAEjBnB,MAAO,CACHoB,OAAQF,EAAMG,QAAQ,GACtBC,QAASJ,EAAMG,QAAQ,IAE3BlB,KAAM,CACFoB,UAAWL,EAAMG,QAAQ,GACzBG,aAAcN,EAAMG,QAAQ,GAC5BI,aAAcP,EAAMG,QAAQ,GAC5BK,eAAgB,UAEpBpB,sBAAuB,CACnBgB,QAASJ,EAAMG,QAAQ,IAE3BzB,SAAU,CACN+B,WAAYT,EAAMG,QAAQ,GAC1BO,WAAYV,EAAMG,QAAQ,GAC1BQ,cAAeX,EAAMG,QAAQ,GAC7BS,MAAOZ,EAAMa,QAAQC,gBAAgBd,EAAMa,QAAQE,WAAWC,UAElEpB,eAAgB,CACZqB,gBAAiBjB,EAAMkB,OAAOC,eAAeC,qBAEjD1B,WAAY,CACRkB,MAAOZ,EAAMa,QAAQC,gBAAgBd,EAAMa,QAAQE,WAAWC,SAC9DK,QAAS,UA4bFtB,CAAmB/H","file":"APIConsole.2e8bad8f0aa05c463479.bundle.js","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport 'swagger-ui-react/swagger-ui.css';\nimport SwaggerUILib from 'swagger-ui-react';\n\nconst disableAuthorizeAndInfoPlugin = function () {\n    return {\n        wrapComponents: {\n            info: () => () => null,\n            authorizeBtn: () => () => null,\n        },\n    };\n};\n/**\n *\n * @class SwaggerUI\n * @extends {Component}\n */\nconst SwaggerUI = (props) => {\n    const {\n        spec, accessTokenProvider, authorizationHeader, api, securitySchemeType,\n    } = props;\n\n    const componentProps = {\n        spec,\n        validatorUrl: null,\n        defaultModelsExpandDepth: -1,\n        docExpansion: 'list',\n        requestInterceptor: (req) => {\n            const { url } = req;\n            const { context } = api;\n            const patternToCheck = `${context}/*`;\n            if (authorizationHeader === 'apikey') {\n                req.headers[authorizationHeader] = accessTokenProvider();\n            } else if (securitySchemeType === 'BASIC') {\n                req.headers[authorizationHeader] = 'Basic ' + accessTokenProvider();\n            } else if (securitySchemeType === 'TEST') {\n                req.headers[authorizationHeader] = accessTokenProvider();\n            } else {\n                req.headers[authorizationHeader] = 'Bearer ' + accessTokenProvider();\n            }\n            if (url.endsWith(patternToCheck)) {\n                req.url = url.substring(0, url.length - 2);\n            } else if (url.includes(patternToCheck + '?')) { // Check for query parameters.\n                const splitTokens = url.split('/*?');\n                req.url = splitTokens.length > 1 ? splitTokens[0] + '?' + splitTokens[1] : splitTokens[0];\n            }\n            return req;\n        },\n        defaultModelExpandDepth: -1,\n        plugins: [disableAuthorizeAndInfoPlugin],\n    };\n\n    const [render, setRender] = useState();\n    const [layoutRender, setlayoutRender] = useState();\n\n    useEffect(() => {\n        if (!layoutRender) return;\n        const len = document.querySelectorAll('.opblock .authorization__btn');\n        let i = 0;\n        for (; i < len.length; i++) {\n            len[i].remove();\n        }\n        document.querySelector('.schemes select').setAttribute('id', 'schemes');\n        document.getElementById('unlocked').parentNode.parentNode.remove();\n        setlayoutRender(false);\n    }, [layoutRender]);\n\n    useEffect(() => {\n        setlayoutRender(true);\n    }, [render]);\n\n    return (\n        <>\n            <SwaggerUILib {...componentProps} />\n            {setRender}\n        </>\n    );\n};\n\nSwaggerUI.propTypes = {\n    accessTokenProvider: PropTypes.func.isRequired,\n    authorizationHeader: PropTypes.string.isRequired,\n    api: PropTypes.shape({\n        context: PropTypes.string.isRequired,\n    }).isRequired,\n    spec: PropTypes.string.isRequired,\n};\nexport default SwaggerUI;\n","/*\n * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n *\n * WSO2 Inc. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\nimport Icon from '@material-ui/core/Icon';\nimport AuthManager from 'AppData/AuthManager';\nimport Paper from '@material-ui/core/Paper';\nimport CloudDownloadRounded from '@material-ui/icons/CloudDownloadRounded';\nimport { ApiContext } from '../ApiContext';\nimport Progress from '../../../Shared/Progress';\nimport Api from '../../../../data/api';\nimport SwaggerUI from './SwaggerUI';\nimport TryOutController from './TryOutController';\nimport Application from '../../../../data/Application';\n\n/**\n * @inheritdoc\n * @param {*} theme theme\n */\nconst styles = (theme) => ({\n    buttonIcon: {\n        marginRight: 10,\n    },\n    paper: {\n        margin: theme.spacing(1),\n        padding: theme.spacing(1),\n    },\n    grid: {\n        marginTop: theme.spacing(4),\n        marginBottom: theme.spacing(4),\n        paddingRight: theme.spacing(2),\n        justifyContent: 'center',\n    },\n    userNotificationPaper: {\n        padding: theme.spacing(2),\n    },\n    titleSub: {\n        marginLeft: theme.spacing(2),\n        paddingTop: theme.spacing(2),\n        paddingBottom: theme.spacing(2),\n        color: theme.palette.getContrastText(theme.palette.background.default),\n    },\n    swaggerUIPaper: {\n        backgroundColor: theme.custom.apiDetailPages.swaggerUIBackground,\n    },\n    buttonText: {\n        color: theme.palette.getContrastText(theme.palette.background.default),\n        display: 'flex',\n    },\n});\n\n/**\n *\n *\n * @class ApiConsole\n * @extends {React.Component}\n */\nclass ApiConsole extends React.Component {\n    /**\n     *Creates an instance of ApiConsole.\n     * @param {*} props properties\n     * @memberof ApiConsole\n     */\n    constructor(props) {\n        super(props);\n        this.state = {\n            securitySchemeType: 'OAUTH',\n            username: '',\n            password: '',\n            scopes: [],\n            selectedKeyType: 'PRODUCTION',\n            keys: [],\n            productionApiKey: '',\n            sandboxApiKey: '',\n            selectedKeyManager: 'Resident Key Manager',\n        };\n        this.accessTokenProvider = this.accessTokenProvider.bind(this);\n        this.updateSwagger = this.updateSwagger.bind(this);\n        this.setSecurityScheme = this.setSecurityScheme.bind(this);\n        this.setSelectedEnvironment = this.setSelectedEnvironment.bind(this);\n        this.setProductionAccessToken = this.setProductionAccessToken.bind(this);\n        this.setSandboxAccessToken = this.setSandboxAccessToken.bind(this);\n        this.setUsername = this.setUsername.bind(this);\n        this.setPassword = this.setPassword.bind(this);\n        this.setSelectedKeyType = this.setSelectedKeyType.bind(this);\n        this.setSectedKeyManager = this.setSelectedKeyManager.bind(this);\n        this.setKeys = this.setKeys.bind(this);\n        this.updateAccessToken = this.updateAccessToken.bind(this);\n        this.setProductionApiKey = this.setProductionApiKey.bind(this);\n        this.setSandboxApiKey = this.setSandboxApiKey.bind(this);\n    }\n\n    /**\n     * @memberof ApiConsole\n     */\n    componentDidMount() {\n        const { api } = this.context;\n        const apiID = api.id;\n        const user = AuthManager.getUser();\n        let apiData;\n        let environments;\n        let containerMngEnvironments;\n        let labels;\n        let selectedEnvironment;\n        let swagger;\n        let productionAccessToken;\n        let sandboxAccessToken;\n\n        this.apiClient = new Api();\n        const promiseAPI = this.apiClient.getAPIById(apiID);\n\n        promiseAPI\n            .then((apiResponse) => {\n                apiData = apiResponse.obj;\n                if (apiData.endpointURLs) {\n                    environments = apiData.endpointURLs.map((endpoint) => { return endpoint.environmentName; });\n                }\n                containerMngEnvironments = apiData.ingressURLs;\n                if (apiData.labels) {\n                    labels = apiData.labels.map((label) => { return label.name; });\n                }\n                if (apiData.scopes) {\n                    const scopeList = apiData.scopes.map((scope) => { return scope.key; });\n                    this.setState({ scopes: scopeList });\n                }\n                if (environments && environments.length > 0) {\n                    [selectedEnvironment] = environments;\n                    return this.apiClient.getSwaggerByAPIIdAndEnvironment(apiID, selectedEnvironment);\n                } else if (containerMngEnvironments\n                    && containerMngEnvironments.some((env) => env.clusterDetails.length > 0)) {\n                    const { clusterDetails: [{ clusterName }] } = containerMngEnvironments\n                        .find((env) => env.clusterDetails.length > 0);\n                    selectedEnvironment = clusterName;\n                    return this.apiClient.getSwaggerByAPIIdAndClusterName(apiID, clusterName);\n                } else if (labels && labels.length > 0) {\n                    [selectedEnvironment] = labels;\n                    return this.apiClient.getSwaggerByAPIIdAndLabel(apiID, selectedEnvironment);\n                } else {\n                    return this.apiClient.getSwaggerByAPIId(apiID);\n                }\n            })\n            .then((swaggerResponse) => {\n                swagger = swaggerResponse.obj;\n\n                let defaultSecurityScheme = 'OAUTH';\n                if (!apiData.securityScheme.includes('oauth2')) {\n                    defaultSecurityScheme = apiData.securityScheme.includes('api_key') ? 'API-KEY' : 'BASIC';\n                }\n\n                this.setState({\n                    api: apiData,\n                    swagger,\n                    environments,\n                    containerMngEnvironments,\n                    labels,\n                    productionAccessToken,\n                    sandboxAccessToken,\n                    selectedEnvironment,\n                    securitySchemeType: defaultSecurityScheme,\n                });\n                if (user != null) {\n                    return this.apiClient.getSubscriptions(apiID);\n                } else {\n                    return null;\n                }\n            })\n            .catch((error) => {\n                if (process.env.NODE_ENV !== 'production') {\n                    console.error(error);\n                }\n                const { status } = error;\n                if (status === 404) {\n                    this.setState({ notFound: true });\n                }\n            });\n    }\n\n    /**\n     * Set SecurityScheme value\n     * @memberof ApiConsole\n     */\n    setSecurityScheme(securityScheme) {\n        this.setState({ securitySchemeType: securityScheme });\n    }\n\n    /**\n     * Set Selected Environment\n     * @memberof ApiConsole\n     */\n    setSelectedEnvironment(selectedEnvironment) {\n        this.setState({ selectedEnvironment });\n    }\n\n    /**\n     * Set Production Access Token\n     * @memberof ApiConsole\n     */\n    setProductionAccessToken(productionAccessToken) {\n        this.setState({ productionAccessToken });\n    }\n\n    /**\n     * Set Sandbox Access Token\n     * @memberof ApiConsole\n     */\n    setSandboxAccessToken(sandboxAccessToken) {\n        this.setState({ sandboxAccessToken });\n    }\n\n    /**\n     * Set Production API Key\n     * @memberof ApiConsole\n     */\n    setProductionApiKey(productionApiKey) {\n        this.setState({ productionApiKey });\n    }\n\n    /**\n     * Set Sandbox API Key\n     * @memberof ApiConsole\n     */\n    setSandboxApiKey(sandboxApiKey) {\n        this.setState({ sandboxApiKey });\n    }\n\n    /**\n     * Set Username\n     * @memberof ApiConsole\n     */\n    setUsername(username) {\n        this.setState({ username });\n    }\n\n    /**\n     * Set Password\n     * @memberof ApiConsole\n     */\n    setPassword(password) {\n        this.setState({ password });\n    }\n\n    /**\n     * Set Password\n     * @memberof ApiConsole\n     */\n    setSelectedKeyType(selectedKeyType, isUpdateToken, selectedApplication) {\n        if (isUpdateToken) {\n            this.setState({ selectedKeyType }, this.updateAccessToken(selectedApplication));\n        } else {\n            this.setState({ selectedKeyType });\n        }\n    }\n\n    /**\n     * Set Password\n     * @memberof ApiConsole\n     */\n    setSelectedKeyManager(selectedKeyManager, isUpdateToken, selectedApplication) {\n        if (isUpdateToken) {\n            this.setState({ selectedKeyManager }, this.updateAccessToken(selectedApplication));\n        } else {\n            this.setState({ selectedKeyManager });\n        }\n    }\n\n    setKeys(keys) {\n        this.setState({ keys });\n    }\n\n    /**\n     * Load the access token for given key type\n     * @memberof TryOutController\n     */\n    updateAccessToken(selectedApplication) {\n        const {\n            selectedKeyType, selectedKeyManager, keys,\n        } = this.state;\n        let accessToken;\n        if (keys.get(selectedKeyManager) && keys.get(selectedKeyManager).keyType === selectedKeyType) {\n            ({ accessToken } = keys.get(selectedKeyManager).token);\n            if (selectedKeyType === 'PRODUCTION') {\n                this.setProductionAccessToken(accessToken);\n            } else {\n                this.setSandboxAccessToken(accessToken);\n            }\n        } else {\n            Application.get(selectedApplication)\n                .then((application) => {\n                    return application.getKeys(selectedKeyType);\n                })\n                .then((appKeys) => {\n                    if (appKeys.get(selectedKeyManager)\n                    && appKeys.get(selectedKeyManager).keyType === selectedKeyType) {\n                        ({ accessToken } = appKeys.get(selectedKeyManager).token);\n                    }\n                    if (appKeys.get(selectedKeyManager).keyType === 'PRODUCTION') {\n                        this.setProductionAccessToken(accessToken);\n                    } else {\n                        this.setSandboxAccessToken(accessToken);\n                    }\n                    this.setKeys(appKeys);\n                });\n        }\n    }\n\n    /**\n     *\n     * Provids the access token to the Swagger UI\n     * @returns {*} access token\n     * @memberof ApiConsole\n     */\n    accessTokenProvider() {\n        const {\n            securitySchemeType, username, password, productionAccessToken,\n            sandboxAccessToken, selectedKeyType, productionApiKey, sandboxApiKey,\n        } = this.state;\n        if (securitySchemeType === 'BASIC') {\n            const credentials = username + ':' + password;\n            return btoa(credentials);\n        }\n        if (securitySchemeType === 'API-KEY') {\n            if (selectedKeyType === 'PRODUCTION') {\n                return productionApiKey;\n            } else {\n                return sandboxApiKey;\n            }\n        } else if (selectedKeyType === 'PRODUCTION') {\n            return productionAccessToken;\n        } else {\n            return sandboxAccessToken;\n        }\n    }\n\n    /**\n     * Load the swagger file of the given environment\n     * @memberof ApiConsole\n     */\n    updateSwagger(environment) {\n        const {\n            api, environments, containerMngEnvironments,\n        } = this.state;\n        let promiseSwagger;\n\n        if (environment) {\n            if (environments.includes(environment)) {\n                promiseSwagger = this.apiClient.getSwaggerByAPIIdAndEnvironment(api.id, environment);\n            } else if (containerMngEnvironments.some((env) => env.clusterDetails.length > 0\n                && env.clusterDetails.some((cluster) => cluster.clusterName === environment))) {\n                promiseSwagger = this.apiClient.getSwaggerByAPIIdAndClusterName(api.id, environment);\n            } else {\n                promiseSwagger = this.apiClient.getSwaggerByAPIIdAndLabel(api.id, environment);\n            }\n        } else {\n            promiseSwagger = this.apiClient.getSwaggerByAPIId(api.id);\n        }\n        promiseSwagger.then((swaggerResponse) => {\n            this.setState({ swagger: swaggerResponse.obj });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     * @memberof ApiConsole\n     */\n    render() {\n        const { classes } = this.props;\n        const {\n            api, notFound, swagger, securitySchemeType, selectedEnvironment, labels, environments, scopes,\n            username, password, productionAccessToken, sandboxAccessToken, selectedKeyType,\n            sandboxApiKey, productionApiKey, selectedKeyManager, containerMngEnvironments,\n        } = this.state;\n        const user = AuthManager.getUser();\n        const downloadSwagger = JSON.stringify({ ...swagger });\n        const downloadLink = 'data:text/json;charset=utf-8, ' + encodeURIComponent(downloadSwagger);\n        const fileName = 'swagger.json';\n\n        if (api == null || swagger == null) {\n            return <Progress />;\n        }\n        if (notFound) {\n            return 'API Not found !';\n        }\n        let isApiKeyEnabled = false;\n        let authorizationHeader = api.authorizationHeader ? api.authorizationHeader : 'Authorization';\n        if (api && api.securityScheme) {\n            isApiKeyEnabled = api.securityScheme.includes('api_key');\n            if (isApiKeyEnabled && securitySchemeType === 'API-KEY') {\n                authorizationHeader = 'apikey';\n            }\n        }\n        const isPrototypedAPI = api.lifeCycleStatus && api.lifeCycleStatus.toLowerCase() === 'prototyped';\n        return (\n            <>\n                <Typography variant='h4' className={classes.titleSub} component='h2'>\n                    <FormattedMessage id='Apis.Details.ApiConsole.ApiConsole.title' defaultMessage='Try Out' />\n                </Typography>\n                <Paper className={classes.paper}>\n                    <Grid container className={classes.grid}>\n                        {!isPrototypedAPI && !user && (\n                            <Grid item md={6}>\n                                <Paper className={classes.userNotificationPaper}>\n                                    <Typography variant='h5' component='h3'>\n                                        <Icon>warning</Icon>\n                                        {' '}\n                                        <FormattedMessage id='notice' defaultMessage='Notice' />\n                                    </Typography>\n                                    <Typography component='p'>\n                                        <FormattedMessage\n                                            id='api.console.require.access.token'\n                                            defaultMessage={'You need an access token to try the API. Please log '\n                                            + 'in and subscribe to the API to generate an access token. If you already '\n                                            + 'have an access token, please provide it below.'}\n                                        />\n                                    </Typography>\n                                </Paper>\n                            </Grid>\n                        )}\n                    </Grid>\n\n                    <TryOutController\n                        setSecurityScheme={this.setSecurityScheme}\n                        securitySchemeType={securitySchemeType}\n                        setSelectedEnvironment={this.setSelectedEnvironment}\n                        selectedEnvironment={selectedEnvironment}\n                        productionAccessToken={productionAccessToken}\n                        setProductionAccessToken={this.setProductionAccessToken}\n                        sandboxAccessToken={sandboxAccessToken}\n                        setSandboxAccessToken={this.setSandboxAccessToken}\n                        swagger={swagger}\n                        labels={labels}\n                        containerMngEnvironments={containerMngEnvironments}\n                        environments={environments}\n                        scopes={scopes}\n                        setUsername={this.setUsername}\n                        setPassword={this.setPassword}\n                        username={username}\n                        password={password}\n                        setSelectedKeyType={this.setSelectedKeyType}\n                        selectedKeyType={selectedKeyType}\n                        setSelectedKeyManager={this.setSelectedKeyManager}\n                        selectedKeyManager={selectedKeyManager}\n                        updateSwagger={this.updateSwagger}\n                        setKeys={this.setKeys}\n                        setProductionApiKey={this.setProductionApiKey}\n                        setSandboxApiKey={this.setSandboxApiKey}\n                        productionApiKey={productionApiKey}\n                        sandboxApiKey={sandboxApiKey}\n                        api={this.state.api}\n                    />\n\n                    <Grid container>\n                        <Grid xs={10} item />\n                        <Grid xs={2} item>\n                            <a href={downloadLink} download={fileName}>\n                                <Typography component='span' className={classes.buttonText}>\n                                    <CloudDownloadRounded className={classes.buttonIcon} />\n                                    <FormattedMessage\n                                        id='Apis.Details.APIConsole.APIConsole.download.swagger'\n                                        defaultMessage='Swagger ( /swagger.json )'\n                                    />\n                                </Typography>\n                            </a>\n                        </Grid>\n                    </Grid>\n                </Paper>\n                <Paper className={classes.swaggerUIPaper}>\n                    <SwaggerUI\n                        api={this.state.api}\n                        accessTokenProvider={this.accessTokenProvider}\n                        spec={swagger}\n                        authorizationHeader={authorizationHeader}\n                        securitySchemeType={securitySchemeType}\n                    />\n                </Paper>\n            </>\n        );\n    }\n}\n\nApiConsole.propTypes = {\n    classes: PropTypes.shape({\n        paper: PropTypes.string.isRequired,\n        titleSub: PropTypes.string.isRequired,\n        grid: PropTypes.string.isRequired,\n        userNotificationPaper: PropTypes.string.isRequired,\n        buttonIcon: PropTypes.string.isRequired,\n    }).isRequired,\n};\n\nApiConsole.contextType = ApiContext;\n\nexport default withStyles(styles)(ApiConsole);\n"],"sourceRoot":""}